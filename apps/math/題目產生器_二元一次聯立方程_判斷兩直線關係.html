<!Doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
        <style>
            table{
                font-size: 20px;
            }
            tr{
            	height: 120px ;
            }
            input{
            	max-width: 30px;
                text-align: center;
            }
            b{
                color: blue ;
            }
            .katex { font-size: 1em; }
            .answer{
                visibility: hidden;
                text-align: left;
                color: blue;
            }
        </style>
    </head>
    <body>
        <table>        	
            <thead>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </thead>
            <tbody id="data">
                
                <tr>
                    <td colspan="3"><h3>練習題-判斷兩直線關係</h3></td>
                    <td><button style="height: 50px;width: 100px;" onclick="check();">檢視答案</button></td>
                </tr>
                
               
            </tbody>        	
        </table>
       
    </body>
    <script src="lib/algebra-0.2.6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
    
    <script>
        
        
        var Fraction = algebra.Fraction;
        var Expression = algebra.Expression;
        var Equation = algebra.Equation;        
        
        var no = 1 ;        
        
        function eq_type1_prepare( target , n ){
            
            for(var i=1 ; i<=n ; i++){

                target.innerHTML = target.innerHTML 
                    +"<tr><td> ("+i+") </td>"
                    +"<td id='q"+i+"' style='width: 300px;text-align: left;'></td>"
                    +"<td></td>"
                    +"<td id='qa"+i+"' class='answer'</td>"
                    +"<td id='qaa"+i+"' class='answer'</td>"
                    +"</tr>" ;                   
                
            }
            
            
        }
        function eq_type1(n ){
            
            for(var i=1 ; i<=n ; i++){
                var q  = document.getElementById('q'+i);
                var qa = document.getElementById('qa'+i);
                var qaa = document.getElementById('qaa'+i);
                eq(q,qa,qaa) ;           
                
            }
            
            
        }        
        
        
        function eq( target , target_answer , target_answer2){
            
            var r = Math.random() ;
            
            if( r<1/3 ){
                same_eq( target , target_answer , target_answer2 ) ;   
            }else if( r<2/3 ){
                parallel_eq( target , target_answer , target_answer2 ) ;    
            }else{
                diff_eq( target , target_answer , target_answer2 ) ;
            }
                
        }
        
        
        function same_eq( target , target_answer , target_answer2){
            
            var e1_x = genNumber(7,true) ;
            var e1_y = genNumber(7,true) ;
            var e1_c = genNumber(7,true) ;
            
            var rate = genNumber(3,true) ;
            var e2_x = e1_x* rate ;
            var e2_y = e1_y* rate ;
            var e2_c = e1_c* rate ;
                
            
            var exp1 = show_express_radom(e1_x,e1_y,e1_c) ;
            var exp2 = show_express_radom(e2_x,e2_y,e2_c) ;
            
            union( target , exp1 , exp2 ) ;
            

            // LCM for x           
            var lcm_x = lcm_two_numbers( e1_x , e2_x ) ;
            var r_ep1 = lcm_x / e1_x ;
            var r_ep2 = lcm_x / e2_x ;
            if( e1_x < 0 ){
                r_ep1*=(-1) ;
            }
            if( e2_x < 0 ){
                r_ep2*=(-1) ;
            }
            exp1 = show_express(e1_x*r_ep1,e1_y*r_ep1,e1_c*r_ep1) ;
            exp2 = show_express(e2_x*r_ep2,e2_y*r_ep2,e2_c*r_ep2) ;
            
            union2( target_answer , exp1 , exp2 ) ;
        
            // LCM  for y          
            target_answer2.textContent= '兩線重疊，無限多解' ;
                
        }
                
        
        function parallel_eq( target , target_answer , target_answer2){
            
            var e1_x = genNumber(7,true) ;
            var e1_y = genNumber(7,true) ;
            var e1_c = genNumber(7,true) ;
            
            var rate = genNumber(3,true) ;
            var e2_x = e1_x* rate ;
            var e2_y = e1_y* rate ;
            var e2_c = e1_c* rate ;
            
            if(Math.random()>0.5){
                e2_c=e2_c*(-1) ;
            }else{
                e2_c=e2_c+genNumber(5,true) ;
            }
                
            
            var exp1 = show_express_radom(e1_x,e1_y,e1_c) ;
            var exp2 = show_express_radom(e2_x,e2_y,e2_c) ;
            
            union( target , exp1 , exp2 ) ;
            

            // LCM for x           
            var lcm_x = lcm_two_numbers( e1_x , e2_x ) ;
            var r_ep1 = lcm_x / e1_x ;
            var r_ep2 = lcm_x / e2_x ;
            if( e1_x < 0 ){
                r_ep1*=(-1) ;
            }
            if( e2_x < 0 ){
                r_ep2*=(-1) ;
            }
            exp1 = show_express(e1_x*r_ep1,e1_y*r_ep1,e1_c*r_ep1) ;
            exp2 = show_express(e2_x*r_ep2,e2_y*r_ep2,e2_c*r_ep2) ;
            union2( target_answer , exp1 , exp2  ) ;
        
            // LCM  for y          
            target_answer2.textContent= '兩線平行，無解' ;
                
        }    
        
        function diff_eq( target , target_answer , target_answer2){
            
            var e1_x = genNumber(7,true) ;
            var e1_y = genNumber(7,true) ;
            var e1_c = genNumber(7,true) ;
            
            var rate = genNumber(3,true) ;
            var e2_x = e1_x* rate ;
            var e2_y = e1_y* rate ;
            var e2_c = e1_c* rate ;
            
            if(Math.random()>0.5){
                e2_y = e2_y*(-1) ;
            }else{
                e2_y = e2_y+genNumber(5,true) ;
            }
                
            
            var exp1 = show_express_radom(e1_x,e1_y,e1_c) ;
            var exp2 = show_express_radom(e2_x,e2_y,e2_c) ;
            
            union( target , exp1 , exp2 ) ;
            

            // LCM for x           
            var lcm_x = lcm_two_numbers( e1_x , e2_x ) ;
            var r_ep1 = lcm_x / e1_x ;
            var r_ep2 = lcm_x / e2_x ;
            if( e1_x < 0 ){
                r_ep1*=(-1) ;
            }
            if( e2_x < 0 ){
                r_ep2*=(-1) ;
            }
            exp1 = show_express(e1_x*r_ep1,e1_y*r_ep1,e1_c*r_ep1) ;
            exp2 = show_express(e2_x*r_ep2,e2_y*r_ep2,e2_c*r_ep2) ;
            union2( target_answer , exp1 , exp2  ) ;
        
            // LCM  for y          
            target_answer2.textContent= '兩線相交，有一解' ;
                
        }         
        
        
        
        
        
        function union( target , exp1 , exp2 ){
            var render_context =
                '\\begin{cases}'+
                algebra.toTex(exp1)+'\\\\'+
                algebra.toTex(exp2)+
                '\\end{cases}' ;
            katex.render( render_context , target);
        }
        
        function union2( target , exp1 , exp2  ){
            var render_context =
                '\\begin{cases}'+
                algebra.toTex(exp1)+'\\\\'+
                algebra.toTex(exp2)+
                '\\end{cases}' ;
            katex.render( render_context , target);
        }        
        
        function show_express(coefficient_x , coefficient_y , constant ){
            
            var x = new Expression("x");
            x = x.multiply(coefficient_x) ;
            var y = new Expression("y");
            y = y.multiply(coefficient_y) ;
            var exp = x.add(y);            
            return new Equation(exp,constant) ;
            
            
        }
        
        
        function show_express_radom(coefficient_x , coefficient_y , constant ){
            
            
            var x = new Expression("x");
            var y = new Expression("y");
            x = x.multiply(coefficient_x) ;
            y = y.multiply(coefficient_y) ;
            
            var r = Math.random() ;
            
            if( r< 0.2){
                var exp = x.add(y);         
                return new Equation(exp,constant) ;
            }else if( r<0.45){
                var exp = x.subtract(constant);   
                y = y.multiply(-1) ;
                return new Equation(exp,y) ;    
            }else if( r<0.7 ){
                y = y.multiply(-1) ;
                y = y.add(constant) ;
                return new Equation(x,y) ;     
            }else{
                x = x.multiply(-1) ;
                x = x.add(constant) ;
                return new Equation(y,x) ;
            }
            
            
        }    
        
        function combine_express( exp1 , exp2 , isAdd ){
            var lhs , rhs; 
            if( isAdd ){
                lhs = exp1.lhs.add( exp2.lhs) ;
                rhs = exp1.rhs.add( exp2.rhs) ;
            }else{
                lhs = exp1.lhs.subtract( exp2.lhs) ;
                rhs = exp1.rhs.subtract( exp2.rhs) ;
            }
            return new Equation(lhs,rhs) ;
        }
        
        function genNumber( top , negative ){

        	var n = Math.floor(Math.random()*top)+2;
        	if( negative ){
                if( Math.random() > 0.5 ){
                    return n ;
                }else{
                    return n*(-1) ;
                }
            }else{
                return n ;
            }
        }

        function genPolar(){
            return Math.random()>0.5?1:-1;
        }
        
        function lcm_two_numbers(x, y) {
           if ((typeof x !== 'number') || (typeof y !== 'number')) 
            return false;
          return (!x || !y) ? 0 : Math.abs((x * y) / gcd_two_numbers(x, y));
        }

        function gcd_two_numbers(x, y) {
          x = Math.abs(x);
          y = Math.abs(y);
          while(y) {
            var t = y;
            y = x % y;
            x = t;
          }
          return x;
        }        
        
        
        function check(){
        
            var input = prompt("準備好看答案了嗎？ 是的話請輸入 y") ;
	       if( input=='y'){
               var its = document.getElementsByClassName('answer') ;
               for( var i=0 ; i<its.length ; i++){
                   its[i].style.visibility = "visible"; 
               }
           }


        }
        
        var e = document.getElementById("data") ;
        eq_type1_prepare(e , 3) ;
        eq_type1(3) ;
        //-----------------------------------------
        
        
  
        
    </script>
</html>
